package parcial.ingreso;

import java.util.ArrayList;
import java.util.List;

import parcial.utils.InputHandler;

public class Inicio {
    private List<Registro> usuarios;
    private InputHandler inputHandler;

    public Inicio() {
        this.usuarios = new ArrayList<>();
        this.inputHandler = new InputHandler();
    }

    public void registrarUsuario() {
        String typeCC = obtenerEntrada("Ingrese el tipo de documento:");
        String cc = obtenerEntrada("Ingrese el número de documento:");
        String name = obtenerEntrada("Ingrese el nombre:");
        String lastName = obtenerEntrada("Ingrese el apellido:");
        String email = obtenerEntrada("Ingrese el correo electrónico:");
        String address = obtenerEntrada("Ingrese la dirección:");
        String city = obtenerEntrada("Ingrese la ciudad:");
        String phone = obtenerEntrada("Ingrese el teléfono:");
        String password = obtenerEntrada("Ingrese la contraseña:");
        String confirmPassword = obtenerEntrada("Confirme la contraseña:");

        if (password.equals(confirmPassword)) {
            Registro nuevoUsuario = new Registro(typeCC, cc, name, lastName, email, address, city, phone, password, "user");
            agregarUsuario(nuevoUsuario);
            System.out.println("Usuario registrado correctamente.");
        } else {
            System.out.println("Las contraseñas no coinciden. Intente nuevamente.");
        }
    }

    public void iniciarSesion() {
        String email = obtenerEntrada("Ingrese su correo electrónico:");
        String password = obtenerEntrada("Ingrese su contraseña:");

        int intentos = 0;
        while (intentos < 3) {
            Registro usuario = buscarUsuarioPorEmail(email);
            if (usuario != null && usuario.getPassword().equals(password)) {
                System.out.println("Inicio de sesión exitoso. ¡Bienvenido, " + usuario.getName() + "!");
                return;
            } else {
                System.out.println("Correo electrónico o contraseña incorrectos. Intente nuevamente.");
                intentos++;
                email = obtenerEntrada("Ingrese su correo electrónico:");
                password = obtenerEntrada("Ingrese su contraseña:");
            }
        }
        System.out.println("Número máximo de intentos alcanzado. Cerrando sesión...");
    }

    private String obtenerEntrada(String mensaje) {
        return inputHandler.getStringInput(mensaje);
    }

    private void agregarUsuario(Registro usuario) {
        usuarios.add(usuario);
    }

    private Registro buscarUsuarioPorEmail(String email) {
        for (Registro usuario : usuarios) {
            if (usuario.getEmail().equals(email)) {
                return usuario;
            }
        }
        return null;
    }
}
